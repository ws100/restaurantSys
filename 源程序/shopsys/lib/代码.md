##/ConstVar.dart
```dart
class Const{
  static bool isLogin = false;
  //static String baseUrl = 'http://localhost:8000/';
  static String baseUrl = '服务器地址';

  static int userType = -1;

  static String username = '';

  static int userId = -1;
}
```
##/getData.dart
```dart
import 'dart:ffi';

class Food {
  int id;
  String name;
  String type;
  double price;
  String description;
  String empName;
  String img;

  Food({
    required this.id,
    required this.name,
    required this.type,
    required this.price,
    required this.description,
    required this.empName,
    required this.img,
  });

  factory Food.fromJson(Map<String, dynamic> json) {
    return Food(
      id: json['id'],
      name: json['name'],
      type: json['type'],
      price: (double.parse(json['price'].toString())*1.0),
      description: json['description'],
      empName: json['emp_name']== null ? '':json['emp_name'],
      img: json['img'],
    );
  }
}

Map<int,int> foodOrder = {};
Map<int,Food> idToFood = {}; 

class Order {
  int id;
  int status;
  double price;
  DateTime time;
  List<OrderItem> items;
  
  Order({
    required this.id,
    required this.status,
    required this.time,
    required this.items,
    required this.price,
  });
  
  factory Order.fromJson(Map<String, dynamic> json) {
    var itemList = json['order_content'] as List;
    List<OrderItem> orderItems = itemList.map((item) => OrderItem.fromJson(item)).toList();
    
    return Order(
      id: json['order_id'],
      status: json['order_status'],
      time: DateTime.parse(json['order_time']),
      items: orderItems,
      price: json['order_price'],
    );
  }
}

class OrderItem {
  Food food;
  int num;
  
  OrderItem({
    required this.food,
    required this.num,
  });
  
  factory OrderItem.fromJson(Map<String, dynamic> json) {
    return OrderItem(
      food: Food.fromJson(json['food']),
      num: json['food_num'],
    );
  }
}
```
##/main.dart
```dart
import 'package:flutter/material.dart';
import 'package:shopsys/page/login.dart';
import 'page/tab.dart';

void main() {
  runApp(MyApp());
}

class MyApp extends StatelessWidget {

  // This widget is the root of your application.
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo',
      theme: ThemeData(
        primarySwatch: Colors.orange,
      ),
      initialRoute: '/',
      routes: {
        '/': (context) => const ShopHomePage(),
        '/login': (context) => LoginPage(),
      },

    );
  }
}


```
##page/login.dart
```dart
import 'dart:convert';

import 'package:flutter/material.dart';
import 'package:shopsys/ConstVar.dart';
import 'package:http/http.dart' as http;
import 'package:shared_preferences/shared_preferences.dart';
class LoginPage extends StatefulWidget {
  @override
  _LoginPageState createState() => _LoginPageState();
}

class _LoginPageState extends State<LoginPage> {
  bool _isManager = false;
  String _username = '';
  String _password = '';

  void _login(int type) async {
    final url = Uri.parse(Const.baseUrl + 'login/');
    //post请求加数据
    final data = {'username': _username, 'password': _password,'type':type.toString()};
    final response = await http.post(url, body: data);
    //解析json
    final result = jsonDecode(response.body);
    if (result['status'] == 'success') {
      //登录成功
      //保存登录状态
      Const.isLogin = true;
      Const.userType = type;
      Const.username = _username;
      Const.userId = result['data'];
      //本地存储
      final prefs = await SharedPreferences.getInstance();
      prefs.setBool('isLogin', true);
      prefs.setInt('userType', type);
      prefs.setString('username', _username);
      prefs.setInt('userId', result['data']);
      //跳转到首页
      Navigator.of(context).pushReplacementNamed('/');
    } else {
      //登录失败
      showDialog(
        context: context,
        builder: (context) {
          return AlertDialog(
            title: Text('登录失败'),
            content: Text("用户不存在或密码错误"),
            actions: <Widget>[
              TextButton(
                child: Text('确定'),
                onPressed: () {
                  Navigator.of(context).pop();
                },
              ),
            ],
          );
        },
      );
    }
  }
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('登录页面')
      ),
      body: Padding(
        padding: EdgeInsets.all(16.0),
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: <Widget>[
            Text(
              '用户登录',
              style: TextStyle(fontSize: 20),
            ),
            SizedBox(height: 20),
            TextField(
              decoration: InputDecoration(
                labelText: '帐号',
                border: OutlineInputBorder(),
              ),
              onChanged: (value) {
                setState(() {
                  _username = value;
                });
              },
            ),
            SizedBox(height: 10),
            TextField(
              decoration: InputDecoration(
                labelText: '密码',
                border: OutlineInputBorder(),
              ),
              obscureText: true,
              onChanged: (value) {
                setState(() {
                  _password = value;
                });
              },
            ),
            
            Row(
              mainAxisAlignment: MainAxisAlignment.center,
              children: <Widget>[
                Text('用户登录'),
                Radio(
                  value: false,
                  groupValue: _isManager,
                  onChanged: (value) {
                    setState(() {
                      _isManager = value!;
                    });
                  },
                ),
                SizedBox(width: 20),
                Text('管理员登录'),
                Radio(
                  value: true,
                  groupValue: _isManager,
                  onChanged: (value) {
                    setState(() {
                      _isManager = value!;
                    });
                  },
                ),
              ],
            ),
            SizedBox(height: 20),
            SizedBox(
              width: double.infinity,
              child: ElevatedButton(
                onPressed: () {
                  if (_isManager) {
                    // Handle manager login
                    _login(1);
                  } else {
                    // Handle normal login
                    _login(0);
                  }
                },
                child: Text('登录'),
              ),
            ),
            TextButton(onPressed: (){

            }, child: Text("没有帐号,立即注册"))
          ],
        ),
      ),
    );
  }
}

```
##page/tab.dart
```dart
import 'package:flutter/material.dart';
import 'package:shopsys/page/tabPage/home.dart';

import 'tabPage/order.dart';
import 'tabPage/user.dart';
import 'tabPage/shop.dart';
class ShopHomePage extends StatefulWidget {
  const ShopHomePage({super.key});

  @override
  State<ShopHomePage> createState() => _ShopHomePageState();
}

class _ShopHomePageState extends State<ShopHomePage> {
  int _pageIndex = 0;
  List<Widget> pages = [
    HomePage(),
    const ShopPage(),
    const OrderPage(),
    const UserPage(),
  ];
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('食堂点餐系统'),
      ),
      body: pages[_pageIndex],
      bottomNavigationBar: BottomNavigationBar(

        //显示4个
        type: BottomNavigationBarType.fixed,
        currentIndex: _pageIndex,
        onTap: (index) {
          setState(() {
            _pageIndex = index;
          });
        },
        items: const [
          BottomNavigationBarItem(
            icon: Icon(Icons.home),
            label: '首页',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.restaurant),
            label: '点餐',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.shopping_cart),
            label: '订单',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.person),
            label: '我的',
          ),
        ],
      ),
    );
  }
}

```
##page\tabPage/home.dart
```dart
import 'dart:convert';

import 'package:flutter/material.dart';
import 'package:http/http.dart' as http;
import 'package:flutter/material.dart';
import 'package:shopsys/ConstVar.dart';
import 'package:shared_preferences/shared_preferences.dart';
import '../../getData.dart';

class HomePage extends StatefulWidget {
  @override
  _HomePageState createState() => _HomePageState();
}

class _HomePageState extends State<HomePage> {
  List<Food> hotFoods = [];
  List<Food> discountFoods = [];
  late SharedPreferences prefs;
  void getData() async{
    prefs = await SharedPreferences.getInstance();
    String orderData = prefs.getString('orderData') ?? '[]';
    jsonDecode(orderData).forEach((element) {
      foodOrder[element['id']] = element['num'];
    });
  }
  void getHot() async {
    hotFoods = [];
    final url = Uri.parse(Const.baseUrl+'getFoodHot/');
    print(url);
    final response = await http.get(url);
    //解析json
    final data = jsonDecode(response.body);
    if (data['status'] == 'success') {
      final foods = data['data'];
      for (var food in foods) {
        setState(() {
          hotFoods.add(Food.fromJson(food));
        });
      }
    }
  }
  void getDiscount() async {
    discountFoods = [];
    final url = Uri.parse(Const.baseUrl+'getFoodSale/');
    final response = await http.get(url);
    //解析json
    final data = jsonDecode(response.body);
    if (data['status'] == 'success') {
      final foods = data['data'];
      for (var food in foods) {
        setState(() {
          discountFoods.add(Food.fromJson(food));
        });
      }
    }
  }
  void getLoginData() async{
    prefs = await SharedPreferences.getInstance();
    Const.isLogin = prefs.getBool('isLogin') ?? false;
    Const.userType = prefs.getInt('userType') ?? 0;
    Const.username = prefs.getString('username') ?? '';
    Const.userId = prefs.getInt('userId') ?? 0;
  }
  //初始生命周期
  @override
  void initState() {
    super.initState();
    getHot();
    getDiscount();
    getLoginData();
  }

  @override
  Widget build(BuildContext context) {
    return ListView(
      children: [
        Container(
          height: 200,
          child: Image.network(
            'https://pbcd-1315149677.cos.ap-nanjing.myqcloud.com/mainBar.png',
            fit: BoxFit.cover,
          ),
        ),
        Container(
          padding: EdgeInsets.all(16),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Text(
                '餐厅活动',
                style: TextStyle(
                  fontSize: 18,
                  fontWeight: FontWeight.bold,
                ),
              ),
              SizedBox(height: 8),
              Text(
                '欢迎光临本店，本月特别优惠：满100元减20元！',
                style: TextStyle(
                  fontSize: 16,
                ),
              ),
            ],
          ),
        ),
        Container(
          padding: EdgeInsets.all(16),
          color: Colors.yellow[100],
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Text(
                '折扣商品',
                style: TextStyle(
                  fontSize: 18,
                  fontWeight: FontWeight.bold,
                ),
              ),
              SizedBox(height: 8),
              Text(
                '本店特别推荐以下折扣商品：',
                style: TextStyle(
                  fontSize: 16,
                ),
              ),
              SizedBox(height: 8),
              SizedBox(
                height: 140,
                child: ListView(
                  scrollDirection: Axis.horizontal,
                  children: List.generate(
                    discountFoods.length,
                    (index) => Padding(
                      padding: EdgeInsets.only(right: 8),
                      child: Column(
                        children: [
                          Image.network(
                            discountFoods[index].img,
                            height: 100,
                            width: 100,
                            fit: BoxFit.cover,
                          ),
                          Text(discountFoods[index].name),
                          Text('¥${discountFoods[index].price}'),
                        ],
                      ),
                    ),
                  ),
                ),
              ),
            ],
          ),
        ),
        Container(
          color: Color.fromARGB(255, 255, 228, 196),
          padding: EdgeInsets.all(16),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Text(
                '热门商品',
                style: TextStyle(
                  fontSize: 18,
                  fontWeight: FontWeight.bold,
                ),
              ),
              SizedBox(height: 8),
              Text(
                '本店特别推荐以下热门商品：',
                style: TextStyle(
                  fontSize: 16,
                ),
              ),
              SizedBox(height: 8),
              SizedBox(
                height: 140,
                child: ListView(
                  scrollDirection: Axis.horizontal,
                  children: List.generate(
                    hotFoods.length,
                    (index) => Padding(
                      padding: EdgeInsets.only(right: 8),
                      child: Column(
                        children: [
                          Image.network(
                            hotFoods[index].img,
                            height: 100,
                            width: 100,
                            fit: BoxFit.cover,
                          ),
                          Text(hotFoods[index].name),
                          Text('¥${hotFoods[index].price}'),
                        ],
                      ),
                    ),
                  ),
                ),
              ),
            ],
          ),
        ),
      ],
    );
  }
}
```
##page\tabPage/order.dart
```dart
import 'dart:convert';

import 'package:flutter/material.dart';
import 'package:http/http.dart' as http;
import 'package:shopsys/ConstVar.dart';
import 'package:shopsys/getData.dart';
import 'package:flutter_rating_bar/flutter_rating_bar.dart';
class OrderPage extends StatefulWidget {
  const OrderPage({super.key});

  @override
  State<OrderPage> createState() => _OrderPageState();
}

class OrderCard extends StatefulWidget {
  OrderCard({super.key, required this.order,required this.type,required this.refresh});
  Function refresh;
  Order order;
  int type;
  @override
  State<OrderCard> createState() => _OrderCardState();
}

class _OrderCardState extends State<OrderCard> {
  void pay(int orderId) async{
  final url = Uri.parse(Const.baseUrl+'pay/');
  final response = await http.post(url,body: {'orderId':orderId.toString()});
  //解析json
  final data = jsonDecode(response.body);
  if (data['status'] == 'success') {
    print('支付成功');
  }
  widget.refresh();
}
  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: const EdgeInsets.all(8.0),
      child: Container(
        child: Card(
          child: Padding(
            padding: const EdgeInsets.all(8.0),
            child: Column(
              children: [
                Row(
                  mainAxisAlignment: MainAxisAlignment.spaceBetween,
                  children: [
                    Text('订单号:${widget.order.id}', style: TextStyle(fontSize: 20)),
                    Text(widget.type==0?"未支付":widget.type==1?"制作中":"已完成", style: TextStyle(fontSize: 20, color: Colors.green)),
                  ],
                ),
                Column(
                  children: List.generate(widget.order.items.length, (index) => 
                    Container(
                      padding: EdgeInsets.all(10),
                      margin: EdgeInsets.only(top: 10, bottom: 10),
                          decoration: BoxDecoration(
                            borderRadius: BorderRadius.circular(10),
                            color: Colors.grey[200],
                          ),
                      child: Row(
                        mainAxisAlignment: MainAxisAlignment.spaceBetween,
                        children: [
                          //图片显示
                          SizedBox(
                              width: 90,
                              height: 90,
                              child: ClipOval(
                                child: Image.network(
                                  widget.order.items[index].food.img,
                                  fit: BoxFit.cover,
                                ),
                              ),
                            ),
                          SizedBox(width: 20,), 
                          Expanded(child: Container(
                            width: double.infinity,
                            height: 70,
                            alignment: Alignment.topLeft,
                            child: Column(
                              mainAxisAlignment: MainAxisAlignment.spaceBetween,
                              crossAxisAlignment: CrossAxisAlignment.start,
                              children: [
                                Text("${widget.order.items[index].food.name}",style: TextStyle(fontSize: 18),),
                                Text("单价:${widget.order.items[index].food.price}",style: TextStyle(fontSize: 16,color: Colors.grey),),
                                Text("￥${widget.order.items[index].food.price * widget.order.items[index].num}",style: TextStyle(fontSize: 16,color: Color.fromARGB(255, 255, 0, 0)),),
                              ],
                            ))),   
                          Text('x${widget.order.items[index].num}', style: TextStyle(fontSize: 20)),
                        ],
                      ),
                    ),
                    
                  ),
                ),
                Row(
                  mainAxisAlignment: MainAxisAlignment.spaceBetween,
                  children: [
                    Text(widget.order.time.toString().substring(0,widget.order.time.toString().length-4), style: TextStyle(fontSize: 20, color: Colors.grey)),
                    Text('￥${widget.order.price}', style: TextStyle(fontSize: 20, color: Colors.red)),

                  ],
                ),
                widget.type == 0?
                ElevatedButton(
                  style: ButtonStyle(
                    backgroundColor: MaterialStateProperty.all(Colors.green),
                  ),
                  onPressed: (){
                    //支付弹窗
                    showDialog(context: context, builder: (context){
                      return AlertDialog(
                        title: Text('支付'),
                        content: Text('是否支付${widget.order.price}元'),
                        actions: [
                          TextButton(onPressed: (){
                            Navigator.of(context).pop();
                          }, child: Text('取消')),
                          TextButton(onPressed: (){
                            Navigator.of(context).pop();
                            pay(widget.order.id);
                          }, child: Text('确定')),
                        ],
                      );
                  });
                }, child: Container(
                  width: double.infinity,
                  alignment: Alignment.center,
                  child: Text('立即支付'))):
                widget.type == 1?
                ElevatedButton(
                  style: ButtonStyle(
                    backgroundColor: MaterialStateProperty.all(Color.fromARGB(255, 0, 166, 255)),
                  ),
                  onPressed: (){

                }, child: Container(
                  width: double.infinity,
                  alignment: Alignment.center,
                  child: Text('制作中'))):
                ElevatedButton(
                  style: ButtonStyle(
                    backgroundColor: MaterialStateProperty.all(Color.fromARGB(255, 229, 255, 0)),
                  ),
                  onPressed: (){
                    //评论框
                    showDialog(context: context, builder: (context){
                      return AlertDialog(
                        title: Text('评论'),
                        content: Column(
                          mainAxisSize: MainAxisSize.min,
                          children: [
                            Row(
                              children: [
                                Text('评分:'),
                                SizedBox(height: 20,),
                                RatingBar.builder(
                                  initialRating: 0,
                                  minRating: 0,
                                  direction: Axis.horizontal,
                                  allowHalfRating: true,
                                  itemCount: 5,
                                  itemSize: 30,
                                  itemBuilder: (context, _) => Icon(
                                    Icons.star,
                                    color: Color.fromARGB(255, 255, 0, 0),
                                  ),
                                  onRatingUpdate: (rating) {
                                    print(rating);
                                  },
                                ),
                              ],
                            ),
                            SizedBox(height: 20,),
                            TextField(
                              maxLines: 5,
                              decoration: InputDecoration(
                                hintText: '请输入评论内容',
                                border: OutlineInputBorder(),
                              ),
                            ),
                          ],
                        ),
                        actions: [
                          TextButton(onPressed: (){
                            Navigator.of(context).pop();
                          }, child: Text('取消')),
                          TextButton(onPressed: (){
                            Navigator.of(context).pop();
                          }, child: Text('确定')),
                        ],
                      );
                });}, child: Container(
                  width: double.infinity,
                  alignment: Alignment.center,
                  child: Text('立即评论'))),
              ],
            ),
          ),
        ),
    
      ),
    );
  }
}



class OrderItemCard extends StatefulWidget {
  OrderItemCard(
      {super.key,
      required this.title,
      required this.icon,
      required this.isEnable,
      required this.onPressed});
  bool isEnable;
  String title;
  IconData icon;
  Function onPressed;
  @override
  State<OrderItemCard> createState() => _OrderItemCardState();
}

class _OrderItemCardState extends State<OrderItemCard> {
  
  @override
  Widget build(BuildContext context) {
    return Card(
      child: Container(
        width: 100,
        color: widget.isEnable ? Colors.orange : Colors.white,
        
        child: InkWell(
          onTap: () {
            widget.onPressed();
          },
          child: Column(
            children: [
              Icon(widget.icon),
              Text(widget.title),
            ],
          ),
        ),
      ),
    );
  }
}




class _OrderPageState extends State<OrderPage> {
  List<Order> _orders = [];
  List<Order> unPayOrders = [];
  List<Order> unUseOrders = [];
  List<Order> usedOrders = [];
  void getOrders() async {
    List<Order> _orders = [];
    
    final response = await http.get(Uri.parse(Const.baseUrl+'getOrderInfo/?userId=${Const.userId}'));
    print(Const.baseUrl+'getOrderInfo/?userId=${Const.userId}');
    if (response.statusCode == 200) {
      setState(() {
        final o = jsonDecode(response.body)['data'];
        _orders = o.map<Order>((item) => Order.fromJson(item)).toList();
      });
    }
    setState(() {
      unPayOrders = [];
      unUseOrders = [];
      usedOrders = [];
      _orders.forEach((element) {
        print(element.status);
      if(element.status == 0) unPayOrders.add(element);
      if(element.status == 1) unUseOrders.add(element);
      if(element.status == 2) usedOrders.add(element);
      print(unPayOrders);
    print(unUseOrders);
    print(usedOrders);
    });
    });
    print(_orders);
    print(unPayOrders);
    print(unUseOrders);
    print(usedOrders);
    
  }
  int _curSelect = 0;

  @override
  void initState() {
    // TODO: implement initState
    super.initState();
    getOrders();
  }

  @override
  Widget build(BuildContext context) {
    return Column(
      children:[
        SizedBox(height: 5),
        Row(
      mainAxisAlignment: MainAxisAlignment.spaceEvenly,
      children: [
      OrderItemCard(
        title: '待付款',
        icon: Icons.payment,
        isEnable: _curSelect == 0,
        onPressed: () {
          setState(() {
            _curSelect = 0;
          });
        },
      ),
      OrderItemCard(
        title: '制作中',
        icon: Icons.restaurant_menu,
        isEnable: _curSelect == 1,
        onPressed: () {
          setState(() {
            _curSelect = 1;
          });
        },
      ),
      OrderItemCard(
        title: '已完成',
        icon: Icons.rate_review,
        isEnable: _curSelect == 2,
        onPressed: () {
          setState(() {
            _curSelect = 2;
          });
        },
      ),
    ],
    ),
    Expanded(
      child: ListView(
        children: [
          if(_curSelect == 0)
          for(var i in unPayOrders.reversed)
          OrderCard(order: i,type: 0,refresh:(){
            getOrders();
          }),
          if(_curSelect == 1)
          for(var i in unUseOrders.reversed)
          OrderCard(order: i,type: 1,refresh: (){
            getOrders();
          },),
          if(_curSelect == 2)
          for(var i in usedOrders.reversed)
          OrderCard(order: i,type: 2,refresh: (){
            getOrders();
          },),
        ],
      ),
    )]
    );
  }
}
```
##page\tabPage/shop.dart
```dart
import 'dart:async';
import 'dart:convert';

import 'package:flutter/material.dart';

import 'package:http/http.dart' as http;
import 'package:shared_preferences/shared_preferences.dart';
import 'package:shopsys/ConstVar.dart';
import 'package:shopsys/getData.dart';

void postOrder(Map<int,int> order) async {
  final url = Uri.parse(Const.baseUrl + 'postOrder/');
  Map<String,int> foodOrder = {};
  order.forEach((key, value) {
    foodOrder[key.toString()] = value;
  });
  final body = '{"orderData": ${jsonEncode(foodOrder)}, "userId": ${Const.userId}}';
  final response = await http.post(url, body: body);
  //解析json
  final data = jsonDecode(response.body);
  if (data['status'] == 'success') {
    print('success');
  }
}

class ShopPage extends StatefulWidget {
  const ShopPage({super.key});

  @override
  State<ShopPage> createState() => _ShopPageState();
}

//每个food的项目
class FoodItem extends StatefulWidget {
  FoodItem({super.key, required this.food, required this.controller});
  Food food;
  StreamController controller;
  @override
  State<FoodItem> createState() => _FoodItemState();
}

class _FoodItemState extends State<FoodItem> {
  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: const EdgeInsets.only(top: 8.0, left: 8.0, right: 8.0),
      child: Container(
        height: 150,
        decoration: BoxDecoration(
            color: Colors.white, borderRadius: BorderRadius.circular(6)),
        child: Row(
          children: [
            const SizedBox(
              width: 20,
            ),
            Expanded(
                child: ClipOval(
                    child: Image.network(
              widget.food.img,
              fit: BoxFit.cover,
              height: 100,
              width: 100,
            ))),
            SizedBox(
              width: 20,
            ),
            Expanded(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.start,
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  const SizedBox(
                    height: 10,
                  ),
                  Text(
                    widget.food.name,
                    style: TextStyle(fontSize: 20),
                  ),
                  const SizedBox(
                    height: 8,
                  ),
                  Expanded(
                    child: SingleChildScrollView(
                      child: Text(
                        widget.food.description,
                        style: TextStyle(
                            fontSize: 15,
                            color: Colors.grey,
                            overflow: TextOverflow.fade),
                      ),
                    ),
                  ),
                  Text(
                    '￥${widget.food.price}',
                    style: TextStyle(fontSize: 20, color: Colors.red),
                  ),
                  const SizedBox(
                    height: 10,
                  ),
                ],
              ),
            ),
            SizedBox(
              width: 25,
            ),
            Container(
              height: 35,
              width: 35,
              child: Material(
                color: Colors.red,
                borderRadius: BorderRadius.circular(20),
                elevation: 3,
                child: InkWell(
                    onTap: () {
                      setState(() {
                        foodOrder[widget.food.id] = foodOrder[widget.food.id]! +
                            1;
                      });
                      widget.controller.add(0);
                    },
                    child: Container(
                        height: 35,
                        width: 35,
                        child: Stack(children: [
                          Icon(
                            Icons.add,
                            color: Colors.white,
                            size: 35,
                          ),
                          Positioned(
                              top: 0,
                              right: 0,
                              child: Container(
                                  alignment: Alignment.center,
                                  height: 15,
                                  width: 15,
                                  decoration: BoxDecoration(
                                      color: foodOrder[widget.food.id] == 0
                                          ? Colors.transparent
                                          : Color.fromARGB(255, 244, 158, 54),
                                      borderRadius: BorderRadius.circular(10)),
                                  child: Text(
                                      foodOrder[widget.food.id] == 0 ? '' : '${foodOrder[widget.food.id]}')))
                        ]))),
              ),
            ),
            SizedBox(
              width: 20,
            )
          ],
        ),
      ),
    );
  }
}

//菜品类别的显示项
class TypeBtn extends StatefulWidget {
  TypeBtn(
      {super.key,
      required this.title,
      this.isSelect = false,
      required this.onPressed});
  bool isSelect;
  String title;
  Function onPressed;
  @override
  State<TypeBtn> createState() => _TypeBtnState();
}

//菜品类别的显示项
class _TypeBtnState extends State<TypeBtn> {
  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: const EdgeInsets.only(left: 4, right: 4),
      child: ElevatedButton(
        style: ButtonStyle(
          backgroundColor: MaterialStateProperty.all(widget.isSelect
              ? const Color.fromARGB(255, 255, 215, 184)
              : Colors.white),
          shape: MaterialStateProperty.all(
            const RoundedRectangleBorder(
              borderRadius: BorderRadius.only(
                topLeft: Radius.circular(5),
                bottomLeft: Radius.circular(5),
              ),
            ),
          ),
        ),
        onPressed: () => {
          setState(() {
            widget.onPressed();
          })
        },
        child: Container(
          alignment: Alignment.center,
          height: 30,
          width: double.infinity,
          child: Text(widget.title),
        ),
      ),
    );
  }
}

//商品主页显示
class _ShopPageState extends State<ShopPage> {
  int _curSelect = 0;
  List<Food> allFoods = [];
  Map<String, List<Food>> allType = {};
  List<String> allTypeName = [];
  final _streamController = StreamController<Object>();
  void getAllFood() async {
    allFoods = [];
    final url = Uri.parse(Const.baseUrl + 'getAllFood/');
    final response = await http.get(url);
    //解析json
    final data = jsonDecode(response.body);
    if (data['status'] == 'success') {
      final foods = data['data'];
      for (var food in foods) {
        setState(() {
          allFoods.add(Food.fromJson(food));
        });
      }
    }
    allFoods.forEach((element) {
      //如果不存在赋予0
      if (!foodOrder.containsKey(element.id))foodOrder[element.id] = 0;
      idToFood[element.id] = element;
      if (allType.containsKey(element.type)) {
        allType[element.type]!.add(element);
      } else {
        allType[element.type] = [element];
      }
    });
    allType.forEach((key, value) {
      allTypeName.add(key);
    });
  }
  @override
  void initState() {
    // TODO: implement initState
    super.initState();
    getAllFood();
  }

  @override
  void dispose() {
    // TODO: implement dispose
    _streamController.close();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return StreamBuilder<Object>(
      stream: _streamController.stream,
      builder: (context, snapshot) {
        return Stack(children: [Column(
                children: [
                  Expanded(
                      flex: 2,
                      child: Container(
                        alignment: Alignment.center,
                        width: double.infinity,
                        decoration: const BoxDecoration(
                          image: DecorationImage(
                              image: NetworkImage(
                                  "https://i0.hdslb.com/bfs/archive/7547380321cc72a2ddeca2155cbaed451e3fe3c2.jpg@672w_378h_1c_!web-search-common-cover.webp"),
                              fit: BoxFit.cover),
                        ),
                        child: const Text(
                          "欢迎点餐",
                          style: TextStyle(
                              fontSize: 30,
                              color: Color.fromARGB(255, 0, 0, 0),
                              fontWeight: FontWeight.bold),
                        ),
                      )),
                  Expanded(
                      flex: 7,
                      child: Row(
                        children: [
                          Expanded(
                              flex: 2,
                              child: Container(
                                child: ListView(
                                  children: [
                                        TypeBtn(
                                          title: "全部",
                                          isSelect: _curSelect == 0,
                                          onPressed: () {
                                            setState(() {
                                              _curSelect = 0;
                                            });
                                          },
                                        )
                                      ] +
                                      List.generate(
                                          allTypeName.length,
                                          (index) => TypeBtn(
                                                title: allTypeName[index],
                                                isSelect: index + 1 == _curSelect
                                                    ? true
                                                    : false,
                                                onPressed: () {
                                                  setState(() {
                                                    _curSelect = index + 1;
                                                  });
                                                },
                                              )),
                                ),
                              )),
                          Expanded(
                              flex: 7,
                              child: Padding(
                                padding: const EdgeInsets.all(4.0),
                                child: Container(
                                  decoration: const BoxDecoration(
                                    color: Color.fromARGB(255, 242, 242, 242),
                                    borderRadius: BorderRadius.only(
                                        topLeft: Radius.circular(5),
                                        bottomLeft: Radius.circular(5)),
                                  ),
                                  child: ListView(
                                    children: List.generate(
                                        _curSelect == 0
                                            ? allFoods.length
                                            : allType[allTypeName[_curSelect - 1]]!
                                                .length,
                                        (index) => FoodItem(
                                            food: _curSelect == 0
                                                ? allFoods[index]
                                                : allType[allTypeName[_curSelect - 1]]![
                                                    index],
                                            controller: _streamController)),
                                  ),
                                ),
                              ))
                        ],
                      )),
                ],
              
            
          ),
          Align(
                  alignment: Alignment.bottomCenter,
                  child: SumShop(controller: _streamController,),
                )
              
        ]);
      }
    );
  }
  
  
}

//商品主页显示
class SumShop extends StatefulWidget {
  SumShop({super.key,required this.controller});
  StreamController controller;
  @override
  State<SumShop> createState() => _SumShopState();
}

class _SumShopState extends State<SumShop> {
  double clacSum() {
    double v = 0;
    foodOrder.forEach((key, value) {
      v += idToFood[key]!.price * (value * 1.0);
    });
    return v;
  }
  int calcNumber()
  {
    int v = 0;
    foodOrder.forEach((key, value) {
      v += value;
    });
    return v;
  }
  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: const EdgeInsets.all(8.0),
      child: Container(
        height: 50,
        decoration: BoxDecoration(
          color: Colors.amber,
          borderRadius: BorderRadius.circular(10),
          boxShadow: [
            BoxShadow(
              color: Colors.grey.withOpacity(0.5),
              blurRadius: 5,
              spreadRadius: 2,
              offset: Offset(0, 3),
            ),
          ],
        ),
        child: Row(
          children: [
            Expanded(
              child: InkWell(
                onTap: () {
                  showDialog(
                      context: context, builder: (context) => ShopCarPage(controller: widget.controller,));
                },
                child: Row(
                  children: [
                    SizedBox(
                      width: 30,
                    ),
                    Container(
                      height: 30,
                      width: 30,
                      child: Stack(
                        children: [
                          Icon(
                            Icons.shopping_cart_outlined,
                            size: 30,
                          ),
                          Positioned(
                            right: 0,
                            child: Container(
                              height: 15,
                              width: 15,
                              decoration: BoxDecoration(
                                color: Colors.red,
                                borderRadius: BorderRadius.circular(10),
                              ),
                              child: Center(
                                child: Text(
                                  "${calcNumber()}",
                                  style: TextStyle(
                                      fontSize: 10, color: Colors.white),
                                ),
                              ),
                            ),
                          )
                        ],
                      ),
                    ),
                    SizedBox(
                      width: 30,
                    ),
                    Expanded(
                        child: Text(
                      "预估到手价",
                      style: TextStyle(fontSize: 20),
                    )),
                    SizedBox(
                      width: 10,
                    ),
                    Expanded(
                        child: Text(
                      "￥${clacSum()}",
                      style: TextStyle(fontSize: 20, color: Colors.red),
                    )),
                  ],
                ),
              ),
            ),
            InkWell(
              onTap: () => showDialog(context: context, builder: (context)=>Dialog(
                  child: SizedBox(
                    height: 100,
                    child: Column(
                      children: [
                        Text("提交订单",style: TextStyle(fontSize: 20)),
                        Expanded(child: Center(child: Text("是否提交订单？"))),
                        Row(
                          mainAxisAlignment: MainAxisAlignment.spaceEvenly,
                          children: [
                            TextButton(onPressed: (){
                              if(calcNumber() == 0)
                              {
                                ScaffoldMessenger.of(context).showSnackBar(SnackBar(duration: Duration(milliseconds: 200),content: Text("购物车为空")));
                                Navigator.pop(context);
                                return;
                              }
                              postOrder(foodOrder);
                              setState(() {
                                foodOrder.forEach((key, value) { 
                                  foodOrder[key] = 0;});
                                widget.controller.add(1);
                              });
                              Navigator.pop(context);
                            }, child: Text("确认")),
                            TextButton(onPressed: (){
                              Navigator.pop(context);
                            }, child: Text("取消")),
                          ],
                        )
                      ],
                    ),
                  ),
                ),
              ),
              child: Container(
                width: 80,
                alignment: Alignment.center,
                height: double.infinity,
                decoration: BoxDecoration(
                  color: Color.fromARGB(255, 255, 164, 7),
                  borderRadius: BorderRadius.only(
                    topRight: Radius.circular(10),
                    bottomRight: Radius.circular(10),
                  ),
                ),
                child: Text(
                  "去结算",
                  style: TextStyle(fontSize: 20, color: Colors.white),
                ),
              ),
            )
          ],
        ),
      ),
    );
  }
}

//购物车显示
class ShopCarPage extends StatefulWidget {
  ShopCarPage({super.key,required this.controller});
  StreamController controller;
  @override
  State<ShopCarPage> createState() => _ShopCarPageState();
}

//购物车显示
class _ShopCarPageState extends State<ShopCarPage> {
  List<Food> orderCar = [];
  List<int> orderNum = [];
  List<bool> checkboxList = [];
  void getFoodOrder() {
    foodOrder.forEach((key, value) {
      if (value > 0)
      {
        orderCar.add(idToFood[key]!);
        orderNum.add(value);
        checkboxList.add(true);
      }
    });
  }
  double getSum()
  {
    double v = 0;
    for (int i = 0; i < orderCar.length; i++)
    {
      if (checkboxList[i])v += orderCar[i].price * orderNum[i];
    }
    return v;
  }
  @override
  void initState() {
    // TODO: implement initState
    super.initState();
    getFoodOrder();
  }
  @override
  void dispose() {
    // TODO: implement dispose
    widget.controller.add(0);
    for(int i = 0;i<checkboxList.length;i++)
    {
      if (!checkboxList[i])
      {
        foodOrder[orderCar[i].id] = 0;
      }
      else
      {
        foodOrder[orderCar[i].id] = orderNum[i];
      }
    }
    super.dispose();
  }
  int calcNumber()
  {
    int v = 0;
    foodOrder.forEach((key, value) {
      v += value;
    });
    return v;
  }
  @override
  Widget build(BuildContext context) {
    return Dialog(
      child: Container(
        width: 400,
        height: 800,
        decoration: BoxDecoration(
          color: Colors.white,
          borderRadius: BorderRadius.circular(50),
        ),
        child: Column(
          children: [
            const SizedBox(
              height: 40,
              child: Text(
                "购物车",
                style: TextStyle(fontSize: 20),
              ),
            ),
            SizedBox(
              height: 520,
              child: ListView(
                children: 
                  List.generate(orderCar.length, (index) => Padding(
                    padding: const EdgeInsets.all(8.0),
                    child: Container(
                      height: 100,
                      decoration: BoxDecoration(
                        color: Colors.orange[100],
                        borderRadius: BorderRadius.circular(10),
                      ),
                      child: Row(
                        children: 
                        [
                          //选择按钮
                          SizedBox(
                            width: 30,
                            height: 30,
                            child: Checkbox(
                              value: checkboxList[index],
                              onChanged: (value) {
                                setState(() {
                                  if (value == true)
                                  {
                                    checkboxList[index] = true;
                                  }
                                  else
                                  {
                                    checkboxList[index] = false;
                                  }
                                });
                              },
                            ),
                          ),
                          const SizedBox(
                            width: 10,
                          ),
                          SizedBox(
                            width: 90,
                            height: 90,
                            child: ClipOval(
                              child: Image.network(
                                orderCar[index].img,
                                fit: BoxFit.cover,
                              ),
                            ),
                          ),
                          Expanded(
                              child: Column(
                            children: [
                              SizedBox(
                                height: 10,
                              ),
                              Expanded(
                                  child: Text(
                                orderCar[index].name,
                                style: TextStyle(fontSize: 20),
                              )),
                              Expanded(
                                child: Text(
                                  "￥${orderCar[index].price}",
                                  style: TextStyle(
                                      fontSize: 20, color: Colors.red),
                                ),
                              ),
                              Expanded(
                                  child: Row(
                                mainAxisAlignment: MainAxisAlignment.center,
                                children: [
                                  Row(
                                    children: [
                                      IconButton(
                                        onPressed: () {
                                          setState(() {
                                            if (orderNum[index] > 1)
                                            {
                                              orderNum[index]--;
                                            }
                                          });
                                        },
                                        icon: Icon(Icons.remove, size: 15),
                                      ),
                                      Container(
                                        width: 20,
                                        child: Text(
                                          "${orderNum[index]}",
                                          textAlign: TextAlign.center,
                                        ),
                                      ),
                                      IconButton(
                                        onPressed: () {
                                          setState(() {
                                            orderNum[index]++;
                                          });
                                        },
                                        icon: Icon(
                                          Icons.add,
                                          size: 15,
                                        ),
                                      ),
                                    ],
                                  )
                                ],
                              )),
                            ],
                          ))
                        ],
                      ),
                    ),
                  )),
              ),
            ),
            Expanded(
              child: Container(),
            ),
            Container(
              height: 50,
              decoration: BoxDecoration(
                color: Colors.orange[100],
                borderRadius: const BorderRadius.only(
                    bottomLeft: Radius.circular(5),
                    bottomRight: Radius.circular(5)),
              ),
              child: Row(
                children: [
                  const SizedBox(
                    width: 30,
                  ),
                  const Expanded(
                      child: Text(
                    "总计",
                    style: TextStyle(fontSize: 20),
                  )),
                  const SizedBox(
                    width: 10,
                  ),
                  Expanded(
                      child: Text(
                    "￥${getSum()}",
                    style: TextStyle(fontSize: 20, color: Colors.red),
                  )),
                  ElevatedButton(onPressed: () => showDialog(context: context, builder: (context)=>Dialog(
                  child: SizedBox(
                    height: 100,
                    child: Column(
                      children: [
                        Text("提交订单",style: TextStyle(fontSize: 20)),
                        Expanded(child: Center(child: Text("是否提交订单？"))),
                        Row(
                          mainAxisAlignment: MainAxisAlignment.spaceEvenly,
                          children: [
                            TextButton(onPressed: (){
                              if(calcNumber() == 0)
                              {
                                ScaffoldMessenger.of(context).showSnackBar(SnackBar(duration: Duration(milliseconds: 200),content: Text("购物车为空")));
                                Navigator.pop(context);
                                Navigator.pop(context);
                                return;
                              }
                              setState(() {
                                foodOrder.forEach((key, value) { 
                                  foodOrder[key] = 0;});
                                widget.controller.add(1);
                              });
                              postOrder(foodOrder);
                              Navigator.pop(context);
                            }, child: Text("确认")),
                            TextButton(onPressed: (){
                              Navigator.pop(context);
                            }, child: Text("取消")),
                          ],
                        )
                      ],
                    ),
                  ),
                ),
              ), child: const Text("去结算")),
                  const SizedBox(
                    width: 30,
                  ),
                ],
              ),
            ),
          ],
        ),
      ),
    );
  }
}

```
##page\tabPage/user.dart
```dart
import 'package:flutter/material.dart';
import 'package:shopsys/ConstVar.dart';
import 'package:shared_preferences/shared_preferences.dart';
class UserPage extends StatefulWidget {
  const UserPage({super.key});

  @override
  State<UserPage> createState() => _UserPageState();
}

class UserItemCard extends StatefulWidget {
  UserItemCard(
      {super.key,
      required this.title,
      required this.icon,
      required this.onPressed});
  String title;
  IconData icon;
  Function onPressed;
  @override
  State<UserItemCard> createState() => _UserItemCardState();
}

class _UserItemCardState extends State<UserItemCard> {
  @override
  Widget build(BuildContext context) {
    return Container(
      decoration: BoxDecoration(
        color: Colors.orange[80],
        borderRadius: BorderRadius.circular(10),
      ),
      child: Padding(
        padding: const EdgeInsets.only(bottom: 5, left: 15, right: 15),
        child: ElevatedButton(
          style: ElevatedButton.styleFrom(
            elevation: 3,
            backgroundColor: Colors.white,
          ),
          onPressed: () => {
            widget.onPressed(),
          },
          child: Row(
            children: [
              IconButton(
                icon: Icon(
                  widget.icon,
                  color: Color.fromARGB(255, 255, 208, 0),
                ),
                onPressed: () {},
              ),
              Expanded(
                  child: Text(
                widget.title,
                style: TextStyle(fontSize: 20),
              )),
            ],
          ),
        ),
      ),
    );
  }
}

class VipIntroduce extends StatefulWidget {
  VipIntroduce(
      {super.key,
      required this.title,
      required this.message,
      required this.icon});
  final Icon icon;
  final String title;
  final String message;
  @override
  State<VipIntroduce> createState() => _VipIntroduceState();
}

class _VipIntroduceState extends State<VipIntroduce> {
  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        IconButton(
          icon: widget.icon,
          onPressed: () {
            showDialog(
              context: context,
              builder: (BuildContext context) {
                return AlertDialog(
                  title: Text(widget.title),
                  content: Text(widget.message),
                  actions: <Widget>[
                    ElevatedButton(
                      child: const Text('关闭'),
                      onPressed: () {
                        Navigator.of(context).pop();
                      },
                    ),
                  ],
                );
              },
            );
          },
        ),
        Text(widget.title),
      ],
    );
  }
}

class _UserPageState extends State<UserPage> {

  void loginOut() async {
    SharedPreferences prefs = await SharedPreferences.getInstance();
    prefs.setBool('isLogin', false);
  }
  @override
  Widget build(BuildContext context) {
    return Stack(
      children: [
        ListView(
          children: [
            Container(
              height: 120,
              decoration: BoxDecoration(
                color: Colors.orange,
                image: DecorationImage(
                  image: NetworkImage(
                    'https://img1.baidu.com/it/u=730870780,1543952458&fm=253&app=120&size=w931&n=0&f=JPEG&fmt=auto?sec=1686848400&t=739fe45a9aad7547f3b2ab6bf799e0d3',
                  ),
                  fit: BoxFit.cover,
                ),
              ),
            ),
            SizedBox(
              height: 30,
            ),
          ],
        ),
        Container(
          child: Column(
            children: [
              SizedBox(
                height: 50,
              ),
              Row(
                children: [
                  SizedBox(
                    width: 40,
                  ),
                  //用户头像有阴影效果
                  Material(
                    elevation: 5,
                    borderRadius: BorderRadius.circular(50),
                    child: CircleAvatar(
                      radius: 50,
                      backgroundImage: NetworkImage(
                        'https://img2.baidu.com/it/u=6985638,3812677033&fm=253&app=138&size=w931&n=0&f=JPEG&fmt=auto?sec=1686848400&t=20b1a2d6d22a4a86e78f94fe9196ead2',
                      ),
                    ),
                  ),
                  SizedBox(
                    width: 30,
                  ),

                  Const.isLogin
                      ? Text(
                          Const.username,
                          style: TextStyle(
                              fontSize: 25,
                              color: Color.fromARGB(255, 0, 0, 0)),
                        )
                      : TextButton(
                          onPressed: () {
                            Navigator.pushNamed(context, '/login');
                          },
                          child: Text("立即登录",
                              style: TextStyle(
                                  fontSize: 25,
                                  color: Color.fromARGB(255, 0, 0, 0))))
                ],
              ),
              Expanded(
                  child: ListView(
                children: [
                  Padding(
                    padding: const EdgeInsets.all(8.0),
                    child: Card(
                        margin: EdgeInsets.all(8.5),
                        elevation: 5,
                        //渐变色
                        shape: RoundedRectangleBorder(
                            borderRadius: BorderRadius.circular(10)),
                        color: Colors.orange[100],
                        child: Container(
                          width: double.infinity,
                          height: 200,
                          child: Column(
                            mainAxisAlignment: MainAxisAlignment.start,
                            crossAxisAlignment: CrossAxisAlignment.start,
                            children: [
                              Container(
                                  child: Text(
                                " 会员卡",
                                style: TextStyle(fontSize: 30),
                              )),
                              const Expanded(child: Text("   会员权益")),
                              Expanded(
                                  child: Row(
                                mainAxisAlignment:
                                    MainAxisAlignment.spaceAround,
                                children: [
                                  VipIntroduce(
                                    title: "热门推荐",
                                    message: "000",
                                    icon: const Icon(
                                      Icons.star,
                                      color: Colors.orangeAccent,
                                      size: 30,
                                    ),
                                  ),
                                  VipIntroduce(
                                    title: "生日礼品",
                                    message: "000",
                                    icon: const Icon(
                                      Icons.card_giftcard,
                                      color: Colors.orangeAccent,
                                      size: 30,
                                    ),
                                  ),
                                  VipIntroduce(
                                    title: "优惠券",
                                    message: "000",
                                    icon: const Icon(
                                      Icons.local_offer,
                                      color: Colors.orangeAccent,
                                      size: 30,
                                    ),
                                  ),
                                  VipIntroduce(
                                    title: "历史记录",
                                    message: "000",
                                    icon: const Icon(
                                      Icons.access_time,
                                      color: Colors.orangeAccent,
                                      size: 30,
                                    ),
                                  ),
                                ],
                              ))
                            ],
                          ),
                        )),
                  ),
                  UserItemCard(
                    title: "我的钱包",
                    icon: Icons.account_balance_wallet,
                    onPressed: () {},
                  ),
                  UserItemCard(
                    title: "我的订单",
                    icon: Icons.assignment,
                    onPressed: () {},
                  ),
                  UserItemCard(
                    title: "我的收藏",
                    icon: Icons.favorite,
                    onPressed: () {},
                  ),
                  UserItemCard(
                    title: "我的评价",
                    icon: Icons.comment,
                    onPressed: () {},
                  ),
                  UserItemCard(
                    title: "退出登录",
                    icon: Icons.location_on,
                    onPressed: () {
                      setState(() {
                        Const.isLogin = false;
                        Const.username = "";
                        loginOut();
                        final snackBar = SnackBar(
                          content: Text('退出登录成功'),
                          action: SnackBarAction(
                            label: '确定',
                            onPressed: () {},
                          ),
                        );
                        Navigator.of(context).pushReplacementNamed('/');
                      });
                    },
                  ),
                ],
              ))
            ],
          ),
        )
      ],
    );
  }
}

```
